<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Medical OCR Analyzer</title>

    <!-- Tailwind via CDN -->
    <script src="https://cdn.tailwindcss.com"></script>

    <style>
        .scroll-area {
            max-height: 22rem;
        }
    </style>

    <script>
        function copyToClipboard(elementId, button) {
            var copyElement = document.getElementById(elementId);
            if (!copyElement) return;

            var text = copyElement.innerText || copyElement.textContent || "";

            if (navigator.clipboard && navigator.clipboard.writeText) {
                navigator.clipboard.writeText(text).then(function () {
                    button.innerText = "Copied";
                    setTimeout(function () { button.innerText = "Copy"; }, 2000);
                }).catch(function () {
                    fallbackCopyText(text, button);
                });
            } else {
                fallbackCopyText(text, button);
            }
        }

        function fallbackCopyText(text, button) {
            var textArea = document.createElement("textarea");
            textArea.value = text;
            textArea.style.position = "fixed";
            textArea.style.left = "-9999px";
            document.body.appendChild(textArea);
            textArea.focus();
            textArea.select();

            try {
                document.execCommand("copy");
                button.innerText = "Copied";
                setTimeout(function () { button.innerText = "Copy"; }, 2000);
            } catch (err) {
                console.error("Fallback: unable to copy", err);
            }

            document.body.removeChild(textArea);
        }

        function toggleSection(sectionId, button) {
            const section = document.getElementById(sectionId);
            if (!section) return;

            const icon = button.querySelector("svg");

            if (section.classList.contains("hidden")) {
                section.classList.remove("hidden");
                if (icon) icon.classList.add("rotate-180");
            } else {
                section.classList.add("hidden");
                if (icon) icon.classList.remove("rotate-180");
            }
        }
    </script>
</head>
<body class="bg-slate-50 text-slate-900">

    <!-- Single unified container for EVERYTHING -->
    <div class="max-w-5xl mx-auto px-4 py-10 space-y-8 text-base">

        <!-- Header with illustration -->
        <header class="flex flex-col md:flex-row md:items-center md:justify-between gap-6">
            <div class="space-y-3 md:max-w-xl">
                <div class="flex items-center gap-3">
                    <div class="h-10 w-10 rounded-full bg-indigo-100 flex items-center justify-center">
                        <!-- Medical + AI chip icon -->
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-indigo-600" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                            <rect x="7" y="7" width="10" height="10" rx="2" stroke-width="1.5"></rect>
                            <path d="M12 9v6M9 12h6" stroke-width="1.5" stroke-linecap="round"></path>
                            <path d="M4 10h1.5M4 14h1.5M18.5 10H20M18.5 14H20M10 4v1.5M14 4v1.5M10 18.5V20M14 18.5V20" stroke-width="1.3" stroke-linecap="round"></path>
                        </svg>
                    </div>
                    <h1 class="text-4xl font-bold tracking-tight text-slate-900">
                        Medical OCR Analyzer
                    </h1>
                </div>
                <p class="text-base text-slate-700">
                    Upload a medical bill or prescription image. The system uses Azure OCR to extract text
                    and an AI model to convert it into a clean, structured key–value summary.
                </p>
            </div>

            <!-- Decorative medical+AI card -->
            <div class="hidden md:block">
                <div class="relative w-60 h-36 rounded-2xl bg-gradient-to-tr from-indigo-500 via-sky-400 to-emerald-400 shadow-lg overflow-hidden">
                    <div class="absolute inset-0 bg-white/10 backdrop-blur-sm"></div>
                    <div class="relative h-full w-full flex items-center justify-center">
                        <div class="space-y-2 text-xs text-indigo-50">
                            <div class="flex items-center gap-2">
                                <span class="inline-flex h-7 w-7 rounded-full bg-white/15 items-center justify-center">
                                    <!-- Heartbeat icon -->
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                        <path d="M3 13s2.5-4 5.5-4 3.5 4 3.5 4 1-4 4-4 5 4 5 4" stroke-width="1.4" stroke-linecap="round" stroke-linejoin="round"></path>
                                    </svg>
                                </span>
                                <span class="uppercase tracking-wide font-semibold">Health + AI</span>
                            </div>
                            <p class="leading-snug">
                                OCR ➝ JSON ➝ AI model<br>
                                Visual summary of key medical details.
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </header>

        <!-- Upload Card: now same width as rest -->
        <section class="bg-white shadow-sm rounded-2xl border border-slate-200 p-5">
            <form method="post" enctype="multipart/form-data" class="space-y-4">
                {% csrf_token %}
                <div class="flex flex-col gap-3">
                    <label class="text-base font-medium text-slate-800">
                        Upload Image
                    </label>
                    <div class="flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between">
                        <div class="flex-1 sm:max-w-md">
                            <input
                                type="file"
                                name="image"
                                accept="image/*"
                                class="block w-full text-base text-slate-700
                                       file:mr-4 file:py-2.5 file:px-4
                                       file:rounded-lg file:border-0
                                       file:text-sm file:font-semibold
                                       file:bg-indigo-50 file:text-indigo-700
                                       hover:file:bg-indigo-100
                                       cursor-pointer"
                                required
                            />
                        </div>
                        <button
                            type="submit"
                            class="inline-flex items-center justify-center px-6 py-2.5 rounded-lg
                                   bg-indigo-600 text-base font-semibold text-white shadow-sm
                                   hover:bg-indigo-700 focus:outline-none focus:ring-2
                                   focus:ring-offset-2 focus:ring-indigo-500"
                        >
                            Analyze
                        </button>
                    </div>
                </div>
                <p class="text-sm text-slate-500">
                    Supported formats: JPG, PNG, etc. Processed only for demonstration in this CC project.
                </p>
            </form>
        </section>

        {% if result %}
        <!-- Results: stacked vertically, same width & alignment -->
        <section class="space-y-6">

            <!-- OCR JSON Result (collapsible) -->
            <div class="bg-white rounded-2xl border border-slate-200 shadow-sm p-4 flex flex-col">
                <div class="flex items-center justify-between mb-3">
                    <div class="flex items-center gap-2">
                        <h2 class="text-base font-semibold text-slate-800">
                            OCR JSON Result
                        </h2>
                        <button
                            type="button"
                            onclick="toggleSection('json-section', this)"
                            class="inline-flex items-center text-sm text-slate-500 hover:text-slate-700 transition-colors"
                        >
                            <span class="mr-1">Toggle</span>
                            <svg
                                xmlns="http://www.w3.org/2000/svg"
                                class="h-4 w-4 transition-transform duration-200"
                                viewBox="0 0 20 20"
                                fill="currentColor"
                            >
                                <path fill-rule="evenodd"
                                      d="M5.23 7.21a.75.75 0 011.06.02L10 10.94l3.71-3.71a.75.75 0 111.06 1.06l-4.24 4.25a.75.75 0 01-1.06 0L5.21 8.29a.75.75 0 01.02-1.08z"
                                      clip-rule="evenodd" />
                            </svg>
                        </button>
                    </div>

                    <button
                        class="inline-flex items-center px-3 py-1.5 rounded-md text-xs font-medium
                               bg-slate-900 text-white hover:bg-slate-800 shadow-sm"
                        onclick="copyToClipboard('json-result', this)"
                        type="button"
                    >
                        Copy
                    </button>
                </div>

                <div
                    id="json-section"
                    class="mt-2 bg-slate-50 rounded-lg border border-slate-200 p-3 scroll-area overflow-auto hidden"
                >
                    <pre
                        id="json-result"
                        class="text-sm font-mono text-slate-800 whitespace-pre-wrap"
                    >{{ result }}</pre>
                </div>
                <p class="mt-2 text-xs text-slate-400">
                    Click “Toggle” to show or hide the raw OCR JSON payload.
                </p>
            </div>

            <!-- Structured Summary -->
            <div class="bg-white rounded-2xl border border-slate-200 shadow-sm p-4 flex flex-col">
                <div class="flex items-center justify-between mb-3">
                    <h2 class="text-base font-semibold text-slate-800">
                        Structured Summary (Key–Value)
                    </h2>
                    <button
                        class="inline-flex items-center px-3 py-1.5 rounded-md text-xs font-medium
                               bg-emerald-600 text-white hover:bg-emerald-700 shadow-sm"
                        onclick="copyToClipboard('prettified-result', this)"
                        type="button"
                    >
                        Copy
                    </button>
                </div>

                <div class="scroll-area overflow-auto rounded-lg border border-slate-200">
                    <table
                        id="prettified-result"
                        class="min-w-full text-sm text-left text-slate-700"
                    >
                        <thead class="bg-slate-50 border-b border-slate-200">
                            <tr>
                                <th scope="col" class="px-3 py-2 font-semibold uppercase tracking-wide text-xs text-slate-500">
                                    Key
                                </th>
                                <th scope="col" class="px-3 py-2 font-semibold uppercase tracking-wide text-xs text-slate-500">
                                    Value
                                </th>
                            </tr>
                        </thead>
                        <tbody class="divide-y divide-slate-100">
                            {{ prettified_result|safe }}
                        </tbody>
                    </table>
                </div>

                <p class="mt-2 text-xs text-slate-400">
                    Generated by the AI model based on the OCR output, mapping raw text into clearer fields such as
                    doctor name, patient name, dates, and amounts.
                </p>
            </div>
        </section>
        {% endif %}
    </div>
</body>
</html>
